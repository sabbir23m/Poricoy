<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poricoy Admin - Inventory Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        :root { --main: #f85606; --dark: #121212; }
        body { font-family: 'Inter', sans-serif; transition: 0.3s; }
        .dark-mode { background: var(--dark); color: #fff; }
        .dark-mode .card { background: #1e1e1e !important; border-color: #333 !important; }
        .dark-mode input, .dark-mode select, .dark-mode textarea { background: #2d2d2d !important; border-color: #444 !important; color: #fff !important; }
        .loader { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; flex-direction: column; color: #fff; }
        .login-overlay { position: fixed; inset: 0; background: #f85606; z-index: 20000; display: flex; align-items: center; justify-content: center; }
        .tab-btn.active { border-bottom: 3px solid #f85606; color: #f85606; font-weight: 800; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- 1. LOGIN SYSTEM -->
    <div id="login-panel" class="login-overlay">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-80 text-center">
            <h2 class="text-2xl font-black text-orange-600 mb-6 italic">PORICOY ADMIN</h2>
            <input type="text" id="user" placeholder="User ID" class="w-full p-3 border rounded-xl mb-4 outline-none text-black">
            <input type="password" id="pass" placeholder="Password" class="w-full p-3 border rounded-xl mb-6 outline-none text-black">
            <button onclick="doLogin()" class="w-full bg-black text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">ENTER PANEL</button>
            <p id="l-err" class="text-red-500 text-xs mt-3 hidden font-bold">Access Denied!</p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div id="loader" class="loader">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-orange-500 mb-4"></div>
            <p id="status-msg" class="font-bold text-sm">Synchronizing Store...</p>
        </div>

        <!-- Header -->
        <header class="bg-white p-4 shadow-sm sticky top-0 z-50 flex justify-between items-center border-b card">
            <h1 class="font-black text-orange-600 italic tracking-tighter text-xl">PORICOY PRO</h1>
            <div class="flex gap-4 items-center">
                <i class="fas fa-moon text-gray-500 cursor-pointer" onclick="toggleDark()"></i>
                <button onclick="handleAuth()" id="authBtn" class="bg-blue-600 text-white px-4 py-1.5 rounded-lg text-[10px] font-bold">CONNECT GOOGLE</button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="bg-white flex border-b sticky top-[65px] z-40 card">
            <button onclick="setTab('add')" id="b-add" class="tab-btn active flex-1 py-4 text-xs font-bold uppercase tracking-widest">Add Product</button>
            <button onclick="setTab('manage'); fetchPosts();" id="b-manage" class="tab-btn flex-1 py-4 text-xs font-bold uppercase tracking-widest text-gray-400">Inventory List</button>
        </div>

        <div class="p-4 max-w-xl mx-auto">
            <!-- SECTION: ADD PRODUCT -->
            <div id="view-add" class="space-y-4">
                <div class="bg-white p-6 rounded-3xl shadow-sm border card">
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Product Name *</label>
                            <input type="text" id="title" class="w-full p-3 border rounded-xl outline-none focus:border-orange-500 shadow-sm" placeholder="Nike, Adidas...">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Price (৳)*</label>
                                <input type="number" id="price" placeholder="৳" class="w-full p-3 border rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Discount Info</label>
                                <input type="number" id="discount" placeholder="Save ৳" class="w-full p-3 border rounded-xl outline-none">
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Category *</label>
                            <div class="flex gap-1">
                                <select id="cat-select" class="flex-1 p-3 border rounded-xl outline-none bg-gray-50 text-xs font-bold"></select>
                                <button onclick="addCat()" class="bg-black text-white px-4 rounded-xl shadow-md"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Sizes</label>
                                <input type="text" id="sizes" class="w-full p-3 border rounded-xl outline-none" placeholder="39,40,41">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Colors (Text)</label>
                                <input type="text" id="colors-text" class="w-full p-3 border rounded-xl outline-none" placeholder="Red, Black">
                            </div>
                        </div>

                        <div class="p-4 border rounded-xl bg-gray-50 card">
                            <label class="text-[10px] font-bold text-gray-500 uppercase block mb-2">Upload All Photos</label>
                            <input type="file" id="main-photos" multiple accept="image/*" class="w-full text-xs">
                        </div>

                        <div class="p-4 border border-orange-100 rounded-xl bg-orange-50/20 card">
                            <label class="text-[10px] font-bold text-orange-600 uppercase block mb-2">Color-Specific Photos</label>
                            <div id="v-list"></div>
                            <button onclick="addV()" class="w-full py-2 bg-white text-orange-600 border border-orange-200 rounded-xl text-[10px] font-bold uppercase mt-2 shadow-sm">+ Add Color Image</button>
                        </div>

                        <div>
                            <label class="text-[10px] font-bold text-gray-400 uppercase">Description</label>
                            <textarea id="description" rows="3" class="w-full p-3 border rounded-xl outline-none" placeholder="Product details..."></textarea>
                        </div>

                        <button onclick="publish()" id="publish-btn" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black text-lg shadow-xl active:scale-95 transition">PUBLISH TO STORE</button>
                    </div>
                </div>
            </div>

            <!-- SECTION: INVENTORY (MODERN LIST VIEW) -->
            <div id="view-manage" class="hidden space-y-3 pb-20">
                <div class="flex justify-between items-center px-2 mb-2">
                    <span id="total-count" class="text-[10px] font-bold text-gray-500 uppercase">Loading items...</span>
                    <button onclick="fetchPosts()" class="text-orange-600 text-xs font-bold"><i class="fas fa-sync-alt mr-1"></i> Refresh</button>
                </div>
                <div id="post-list" class="space-y-3">
                    <!-- Products will load here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const BLOG_ID = '1102146600159472315';
        const CLIENT_ID = '391679215430-eug336ehuuup6rkl61lsa7fm7p9gnmnp.apps.googleusercontent.com';
        const IMGBB_KEY = '53bc8a520ebaed9f8068f8e894c20ef0';

        // --- 2. LOGIN LOGIC ---
        function doLogin() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            if(u === 'sabbir23m' && p === 'poricoy23m') {
                localStorage.setItem('auth_poricoy', 'true');
                location.reload();
            } else {
                document.getElementById('l-err').classList.remove('hidden');
            }
        }
        if(localStorage.getItem('auth_poricoy') === 'true') {
            document.getElementById('login-panel').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }

        // --- 3. CATEGORY & UI LOGIC ---
        let cats = JSON.parse(localStorage.getItem('my_cats')) || ["Sneakers", "Formal", "Sports"];
        function renderCats() {
            document.getElementById('cat-select').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        renderCats();

        function addCat() {
            const n = prompt("New Category:");
            if(n && !cats.includes(n)) {
                cats.push(n); localStorage.setItem('my_cats', JSON.stringify(cats)); renderCats(); document.getElementById('cat-select').value = n;
            }
        }

        function toggleDark() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('admin_dark', document.body.classList.contains('dark-mode'));
        }
        if(localStorage.getItem('admin_dark') === 'true') document.body.classList.add('dark-mode');

        function setTab(t) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'text-gray-400'));
            document.getElementById('b-'+t).classList.add('active');
            document.getElementById('view-add').style.display = t === 'add' ? 'block' : 'none';
            document.getElementById('view-manage').style.display = t === 'manage' ? 'block' : 'none';
        }

        // --- 4. GOOGLE AUTH ---
        let token = new URLSearchParams(window.location.hash.substring(1)).get('access_token');
        if(token) {
            document.getElementById('authBtn').innerText = "ONLINE";
            document.getElementById('authBtn').className = "bg-green-600 text-white px-4 py-1.5 rounded-lg text-[10px] font-bold";
        }
        function handleAuth() {
            const uri = window.location.origin + window.location.pathname;
            const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(uri)}&response_type=token&scope=https://www.googleapis.com/auth/blogger`;
            window.location.assign(url);
        }

        // --- 5. IMAGE UPLOAD & PUBLISH ---
        async function uploadImg(file) {
            const fd = new FormData(); fd.append('image', file);
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: fd });
            const d = await res.json();
            return d.data.url;
        }

        async function publish() {
            if(!token) return alert("Please Connect Google first!");
            const t = document.getElementById('title').value, pr = document.getElementById('price').value, mPh = document.getElementById('main-photos').files;
            if(!t || !pr || mPh.length === 0) return alert("Fill Name, Price and Photo!");

            document.getElementById('loader').style.display = 'flex';
            let gallery = "";
            let colorStr = document.getElementById('colors-text').value;

            try {
                document.getElementById('status-msg').innerText = "Uploading Photos...";
                for(let f of mPh) { const url = await uploadImg(f); gallery += `<img src="${url}" class="p-img"/>`; }

                const rows = document.querySelectorAll('[id^="v-row-"]');
                for(let r of rows) {
                    const cN = r.querySelector('.v-name').value, cF = r.querySelector('.v-file').files[0];
                    if(cN && cF) { const url = await uploadImg(cF); gallery += `<img src="${url}" data-color="${cN}"/>`; colorStr += (colorStr ? "," : "") + cN; }
                }

                const finalHTML = `<div class="product-data" style="display:none"><span class="sizes">${document.getElementById('sizes').value}</span><span class="colors">${colorStr}</span><span class="discount">${document.getElementById('discount').value}</span></div>${pr}<div class="gallery">${gallery}</div><p>${document.getElementById('description').value}</p>`;

                const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts/`, {
                    method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ "title": t, "content": finalHTML, "labels": [document.getElementById('cat-select').value, "LiveProduct"] })
                });
                if(res.ok) { alert("SUCCESS! Product is Live."); location.reload(); }
            } catch (err) { alert("Upload Failed! Check ImgBB Key."); }
            finally { document.getElementById('loader').style.display = 'none'; }
        }

        // --- 6. INVENTORY MANAGEMENT (FETCH & DELETE) ---
        async function fetchPosts() {
            if(!token) return;
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('status-msg').innerText = "Fetching Inventory...";
            
            try {
                // Fetch up to 500 items
                const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts?maxResults=500`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                const list = document.getElementById('post-list');
                
                if(!data.items || data.items.length === 0) {
                    document.getElementById('total-count').innerText = "Total Items: 0";
                    list.innerHTML = "<p class='text-center py-20 text-gray-400'>No products found.</p>";
                    return;
                }

                document.getElementById('total-count').innerText = "Total Items: " + data.items.length;
                
                list.innerHTML = data.items.map(p => {
                    // Try to extract first image for thumbnail
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = p.content;
                    const firstImg = tempDiv.querySelector('img') ? tempDiv.querySelector('img').src : 'https://placehold.co/100x100?text=No+Img';
                    
                    return `
                        <div class="bg-white p-3 rounded-2xl border flex items-center gap-3 shadow-sm card">
                            <img src="${firstImg}" class="w-14 h-14 object-cover rounded-lg border bg-gray-50"/>
                            <div class="flex-1 overflow-hidden text-left">
                                <h4 class="font-bold text-[11px] truncate leading-tight">${p.title}</h4>
                                <p class="text-[9px] text-gray-400 mt-1 uppercase font-semibold tracking-tighter">${p.labels ? p.labels[0] : 'No Category'}</p>
                            </div>
                            <button onclick="del('${p.id}')" class="bg-red-50 text-red-500 w-10 h-10 rounded-xl hover:bg-red-500 hover:text-white transition flex items-center justify-center">
                                <i class="fas fa-trash-alt text-sm"></i>
                            </button>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                alert("Failed to load products. Check token.");
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        async function del(id) {
            if(!confirm("Are you sure? This shoe will be removed from your website permanently.")) return;
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('status-msg').innerText = "Deleting from Blogger...";
            
            try {
                const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if(res.ok) {
                    alert("Deleted Successfully!");
                    fetchPosts(); // Refresh list
                } else {
                    alert("Delete failed. Token might be expired.");
                }
            } catch (e) { alert("Network Error!"); }
            finally { document.getElementById('loader').style.display = 'none'; }
        }

        // Add Variant Helper
        let vId = 0;
        function addV() {
            vId++;
            const div = `<div class="flex items-center gap-2 mb-2 bg-white p-2 rounded-lg border card" id="v-row-${vId}"><input type="text" placeholder="Color" class="v-name p-2 text-[10px] border rounded w-16 uppercase font-bold text-black"><input type="file" class="v-file text-[8px] flex-1"><button onclick="document.getElementById('v-row-${vId}').remove()" class="text-red-500 px-1"><i class="fas fa-trash"></i></button></div>`;
            document.getElementById('v-list').insertAdjacentHTML('beforeend', div);
        }
    </script>
</body>
</html>